[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Church Members",
  "enabled": 1,
  "modified": "2025-05-13 12:48:07.379410",
  "module": "Cfms Plus",
  "name": "Register Member to Group/Ministry",
  "script": "frappe.listview_settings[\"Church Members\"] = {\n    onload: function (list_view) {\n        list_view.page.add_inner_button(__(\"Register or Remove Member from Group/Ministry\"), function () {\n            let dialog = new frappe.ui.Dialog({\n                title: __(\"Register or Remove Member from Group/Ministry\"),\n                fields: [\n                    {\n                        fieldtype: \"Link\",\n                        label: __(\"Member\"),\n                        fieldname: \"member\",\n                        options: \"Church Members\",\n                        reqd: 1,\n                        get_query: function () {\n                            return {\n                                filters: {\n                                    membership_status: \"Active\"\n                                }\n                            };\n                        },\n                        onchange: function () {\n                            check_and_update_button();\n                        }\n                    },\n                    {\n                        fieldtype: \"Link\",\n                        label: __(\"Group/Ministry\"),\n                        fieldname: \"group_ministry\",\n                        options: \"Church Groups and Ministries\",\n                        reqd: 1,\n                        get_query: function () {\n                            return {\n                                filters: {\n                                    group_ministry_status: \"Active\"\n                                }\n                            };\n                        },\n                        onchange: function () {\n                            check_and_update_button();\n                        }\n                    }\n                ],\n                primary_action_label: __(\"Register\"),\n                primary_action: function () {\n                    // This will be dynamically set by check_and_update_button\n                }\n            });\n\n            // Initially set the primary action to \"Register\"\n            dialog.set_primary_action(__(\"Register\"), function () {\n                register_member();\n            });\n\n            // Function to check membership and update the button\n            function check_and_update_button() {\n                let member = dialog.get_value(\"member\");\n                let group_ministry = dialog.get_value(\"group_ministry\");\n\n                if (member && group_ministry) {\n                    frappe.call({\n                        method: \"cfms_plus.cfms_plus.doctype.church_members.church_members.check_member_in_group\",\n                        args: {\n                            member: member,\n                            group_ministry: group_ministry\n                        },\n                        callback: function (r) {\n                            if (r.message) {\n                                // Member is already in the group\n                                dialog.set_primary_action(__(\"Remove\"), function () {\n                                    remove_member();\n                                });\n                                dialog.get_primary_btn()\n                                    .removeClass(\"btn-primary\")\n                                    .addClass(\"btn-danger\");\n                            } else {\n                                // Member is not in the group\n                                dialog.set_primary_action(__(\"Register\"), function () {\n                                    register_member();\n                                });\n                                dialog.get_primary_btn()\n                                    .removeClass(\"btn-danger\")\n                                    .addClass(\"btn-primary\");\n                            }\n                        }\n                    });\n                }\n            }\n\n            // Function to register a member\n            function register_member() {\n                let values = dialog.get_values();\n                frappe.call({\n                    method: \"cfms_plus.cfms_plus.doctype.church_members.church_members.register_member_to_group_ministry\",\n                    args: {\n                        member: values.member,\n                        group_ministry: values.group_ministry\n                    },\n                    callback: function (r) {\n                        if (!r.exc) {\n                            dialog.hide();\n                            list_view.refresh();\n                        }\n                    }\n                });\n            }\n\n            // Function to remove a member\n            function remove_member() {\n                let values = dialog.get_values();\n                frappe.call({\n                    method: \"cfms_plus.cfms_plus.doctype.church_members.church_members.remove_member_from_group_ministry\",\n                    args: {\n                        member: values.member,\n                        group_ministry: values.group_ministry\n                    },\n                    callback: function (r) {\n                        if (!r.exc) {\n                            dialog.hide();\n                            list_view.refresh();\n                        }\n                    }\n                });\n            }\n\n            dialog.show();\n        }).addClass(\"btn-primary\");\n    }\n};",
  "view": "List"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Church Groups and Ministries",
  "enabled": 1,
  "modified": "2025-05-13 12:47:38.725543",
  "module": "Cfms Plus",
  "name": "Register in Group/Ministry Doc",
  "script": "frappe.listview_settings[\"Church Groups and Ministries\"] = {\n    onload: function (list_view) {\n        list_view.page.add_inner_button(__(\"Register or Remove Member from Group/Ministry\"), function () {\n            let dialog = new frappe.ui.Dialog({\n                title: __(\"Register or Remove Member from Group/Ministry\"),\n                fields: [\n                    {\n                        fieldtype: \"Link\",\n                        label: __(\"Member\"),\n                        fieldname: \"member\",\n                        options: \"Church Members\",\n                        reqd: 1,\n                        get_query: function () {\n                            return {\n                                filters: {\n                                    membership_status: \"Active\"\n                                }\n                            };\n                        },\n                        onchange: function () {\n                            check_and_update_button();\n                        }\n                    },\n                    {\n                        fieldtype: \"Link\",\n                        label: __(\"Group/Ministry\"),\n                        fieldname: \"group_ministry\",\n                        options: \"Church Groups and Ministries\",\n                        reqd: 1,\n                        get_query: function () {\n                            return {\n                                filters: {\n                                    group_ministry_status: \"Active\"\n                                }\n                            };\n                        },\n                        onchange: function () {\n                            check_and_update_button();\n                        }\n                    }\n                ],\n                primary_action_label: __(\"Register\"),\n                primary_action: function () {\n                    // This will be dynamically set by check_and_update_button\n                }\n            });\n\n            // Initially set the primary action to \"Register\"\n            dialog.set_primary_action(__(\"Register\"), function () {\n                register_member();\n            });\n\n            // Function to check membership and update the button\n            function check_and_update_button() {\n                let member = dialog.get_value(\"member\");\n                let group_ministry = dialog.get_value(\"group_ministry\");\n\n                if (member && group_ministry) {\n                    frappe.call({\n                        method: \"cfms_plus.cfms_plus.doctype.church_members.church_members.check_member_in_group\",\n                        args: {\n                            member: member,\n                            group_ministry: group_ministry\n                        },\n                        callback: function (r) {\n                            if (r.message) {\n                                // Member is already in the group\n                                dialog.set_primary_action(__(\"Remove\"), function () {\n                                    remove_member();\n                                });\n                                dialog.get_primary_btn()\n                                    .removeClass(\"btn-primary\")\n                                    .addClass(\"btn-danger\");\n                            } else {\n                                // Member is not in the group\n                                dialog.set_primary_action(__(\"Register\"), function () {\n                                    register_member();\n                                });\n                                dialog.get_primary_btn()\n                                    .removeClass(\"btn-danger\")\n                                    .addClass(\"btn-primary\");\n                            }\n                        }\n                    });\n                }\n            }\n\n            // Function to register a member\n            function register_member() {\n                let values = dialog.get_values();\n                frappe.call({\n                    method: \"cfms_plus.cfms_plus.doctype.church_members.church_members.register_member_to_group_ministry\",\n                    args: {\n                        member: values.member,\n                        group_ministry: values.group_ministry\n                    },\n                    callback: function (r) {\n                        if (!r.exc) {\n                            dialog.hide();\n                            list_view.refresh();\n                        }\n                    }\n                });\n            }\n\n            // Function to remove a member\n            function remove_member() {\n                let values = dialog.get_values();\n                frappe.call({\n                    method: \"cfms_plus.cfms_plus.doctype.church_members.church_members.remove_member_from_group_ministry\",\n                    args: {\n                        member: values.member,\n                        group_ministry: values.group_ministry\n                    },\n                    callback: function (r) {\n                        if (!r.exc) {\n                            dialog.hide();\n                            list_view.refresh();\n                        }\n                    }\n                });\n            }\n\n            dialog.show();\n        }).addClass(\"btn-primary\");\n    }\n};",
  "view": "List"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Church Events and Programs",
  "enabled": 1,
  "modified": "2025-05-13 19:34:59.810290",
  "module": "Cfms Plus",
  "name": "Events/Programs Calendar",
  "script": "// public/js/church_events_and_programs_calendar.js\n\nfrappe.views.calendar[\"Church Events and Programs\"] = {\n    doctype: \"Church Events and Programs\",\n\n    // Month/Week/Day Calendar\n    field_map: {\n        start:       \"start\",\n        end:         \"end\",\n        id:          \"id\",\n        title:       \"title\",\n        color:       \"color\",\n        allDay:      \"allDay\",\n        description: \"description\"\n    },\n    get_events_method:\n      \"cfms_plus.cfms_plus.doctype.church_events_and_programs.church_events_and_programs.get_events\",\n\n    // disable Gantt\n    gantt: false,\n\n    // **Gantt** needs these exact keys:\n    gantt_field_map: {\n        id:     \"id\",                 // each record’s unique id\n        name:   \"title\",              // the bar’s label in Gantt\n        start:  \"start\",              // start date\n        end:    \"end\",                // end date\n        color:  \"color\"               // bar colour\n    },\n\n    // filters: [\n    //   {\n    //     fieldtype: \"Link\",\n    //     fieldname: \"group_ministry\",\n    //     options: \"Group Ministry\",\n    //     label: __(\"Group Ministry\")\n    //   }\n    // ],\n\n    options: {\n      eventRender: function(eventObj, $el) {\n        if (eventObj.description) {\n          $el.find(\".fc-title\")\n             .append(`<div class=\"fc-event-desc small\">${eventObj.description}</div>`);\n        }\n      }\n    }\n};\n",
  "view": "List"
 }
]